!function(e,n){(e.indexedDB=window.indexedDB||window.mozIndexedDB||window.webkitIndexedDB||window.msIndexedDB||window.shimIndexedDB)&&(e.IDBTransaction=window.IDBTransaction||window.webkitIDBTransaction||window.msIDBTransaction),"object"==typeof exports&&"undefined"!=typeof module?module.exports=n:"function"==typeof define&&define.amd?define(n):e.dbIndexed=n}(this,class{constructor(e){this.dbName=e||"indexedDB",this.version}version(e){return this.version=10*e,this}async stores(e){return new Promise(async(n,t)=>{let o=Object.keys(e);o.forEach(n=>{this[n]={name:n,dbName:this.dbName,version:this.version,fields:e[n].split(","),get:async function(e){return new Promise((n,t)=>{this.connectDB(this,function(o,r){var s=o.transaction([r.name],"readonly").objectStore(r.name).get(e);s.onerror=t,s.onsuccess=function(){n(s.result)}})})},getAll:async function(){return new Promise(e=>{this.connectDB(this,function(n,t){var o=[],r=n.transaction([t.name],"readonly").objectStore(t.name);r.mozGetAll?r.mozGetAll().onsuccess=function(n){e(n.target.result)}:r.openCursor().onsuccess=function(n){var t=n.target.result;t?(o.push(t.value),t.continue()):e(o)}})})},add:async function(e){return new Promise((n,t)=>{this.connectDB(this,function(o,r){var s=o.transaction([r.name],"readwrite").objectStore(r.name).add(e);s.onerror=t,s.onsuccess=function(){n({...e,id:s.result})}})})},delete:async function(e){return new Promise((n,t)=>{this.connectDB(this,async function(o,r){var s=o.transaction([r.name],"readwrite").objectStore(r.name),i=await s.get(e),c=s.delete(e);c.onerror=t,c.onsuccess=function(){n(i.result)}})})},put:async function(e){return new Promise((n,t)=>{this.connectDB(this,function(o,r){var s=o.transaction([r.name],"readwrite").objectStore(r.name);if(e.id){var i=s.put(e);i.onerror=t,i.onsuccess=function(){n({...e,id:i.result})}}else t("Object without id, can't update.")})})},bulkAdd:async function(e){return new Promise((n,t)=>{this.connectDB(this,function(o,r){var s=o.transaction([r.name],"readwrite").objectStore(r.name),i=e.map(e=>new Promise((n,t)=>{var o=s.add(e);o.onerror=t,o.onsuccess=function(){n({...e,id:o.result})}}));Promise.all(i).then(n).catch(t)})})},clear:async function(){return new Promise(async(e,n)=>{let t=(await this.getAll()).map(e=>this.delete(e.id));Promise.all(t).then(e).catch(n)})},where:function(e){if(void 0===e)throw new Error('Missing "key" to search...');if("string"==typeof e)return{key:e,name:this.name,dbName:this.dbName,version:this.version,equal:async function(n){return new Promise((t,o)=>{var r=indexedDB.open(this.dbName,this.version);r.onerror=console.log,r.onsuccess=(()=>{let o=r.result;o.onversionchange=function(){o.close()};var s=[];o.transaction([this.name],"readonly").objectStore(this.name).openCursor().onsuccess=function(o){var r=o.target.result;r?(r.value[e]===n&&s.push(r.value),r.continue()):t(s)}})})},above:async function(n){return new Promise((t,o)=>{var r=indexedDB.open(this.dbName,this.version);r.onerror=console.log,r.onsuccess=(()=>{let o=r.result;o.onversionchange=function(){o.close()};var s=[];o.transaction([this.name],"readonly").objectStore(this.name).openCursor().onsuccess=function(o){var r=o.target.result;r?(r.value[e]>n&&s.push(r.value),r.continue()):t(s)}})})},below:async function(n){return new Promise((t,o)=>{var r=indexedDB.open(this.dbName,this.version);r.onerror=console.log,r.onsuccess=(()=>{let o=r.result;o.onversionchange=function(){o.close()};var s=[];o.transaction([this.name],"readonly").objectStore(this.name).openCursor().onsuccess=function(o){var r=o.target.result;r?(r.value[e]<n&&s.push(r.value),r.continue()):t(s)}})})},aboveEqual:async function(n){return new Promise((t,o)=>{var r=indexedDB.open(this.dbName,this.version);r.onerror=console.log,r.onsuccess=(()=>{let o=r.result;o.onversionchange=function(){o.close()};var s=[];o.transaction([this.name],"readonly").objectStore(this.name).openCursor().onsuccess=function(o){var r=o.target.result;r?(r.value[e]>=n&&s.push(r.value),r.continue()):t(s)}})})},belowEqual:async function(n){return new Promise((t,o)=>{var r=indexedDB.open(this.dbName,this.version);r.onerror=console.log,r.onsuccess=(()=>{let o=r.result;o.onversionchange=function(){o.close()};var s=[];o.transaction([this.name],"readonly").objectStore(this.name).openCursor().onsuccess=function(o){var r=o.target.result;r?(r.value[e]<=n&&s.push(r.value),r.continue()):t(s)}})})},notEqual:async function(n){return new Promise((t,o)=>{var r=indexedDB.open(this.dbName,this.version);r.onerror=console.log,r.onsuccess=(()=>{let o=r.result;o.onversionchange=function(){o.close()};var s=[];o.transaction([this.name],"readonly").objectStore(this.name).openCursor().onsuccess=function(o){var r=o.target.result;r?(r.value[e]!==n&&s.push(r.value),r.continue()):t(s)}})})}}},connectDB(e,n){var t=indexedDB.open(e.dbName,e.version);t.onerror=console.log,t.onsuccess=(()=>{let o=t.result;o.onversionchange=function(){o.close()},n(o,e)}),t.onupgradeneeded=function(n){var t=n.currentTarget.result;if(!t.objectStoreNames.contains(e.name)){let n={};e.fields.includes("++id")&&(n={keyPath:"id",autoIncrement:!0});var o=t.createObjectStore(e.name,n);e.fields.filter(e=>!e.includes("id")).forEach(e=>{let n=e.replace(/\&/g,"");o.createIndex(n,n,{unique:e.includes("&")})})}}}}});var r=indexedDB.open(this.dbName,this.version);r.onerror=t,r.onsuccess=(()=>{let e=r.result;e.onversionchange=function(){e.close()},n("Finished")}),r.onupgradeneeded=function(n){var t=n.currentTarget.result;o.forEach(n=>{if(!t.objectStoreNames.contains(n)){let o={},r=e[n].split(",");r.includes("++id")&&(o={keyPath:"id",autoIncrement:!0});let s=t.createObjectStore(n,o);r.filter(e=>!e.includes("id")).forEach(e=>{let n=e.replace(/\&/g,"");s.createIndex(n,n,{unique:e.includes("&")})})}})}})}});
