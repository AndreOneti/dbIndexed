!function(e,n){(e.indexedDB=window.indexedDB||window.mozIndexedDB||window.webkitIndexedDB||window.msIndexedDB||window.shimIndexedDB)&&(e.IDBTransaction=window.IDBTransaction||window.webkitIDBTransaction||window.msIDBTransaction),"object"==typeof exports&&"undefined"!=typeof module?module.exports=n:"function"==typeof define&&define.amd?define(n):e.dbIndexed=n}(this,class{constructor(e){this.dbName=e||"todoStore",this.version}version(e){return this.version=10*e,this}async stores(e){return new Promise(async(n,o)=>{let t=Object.keys(e);t.forEach(n=>{this[n]={name:n,dbName:this.dbName,version:this.version,fields:e[n].split(","),get:async function(e){return new Promise((n,o)=>{this.connectDB(this,function(t,s){var r=t.transaction([s.name],"readonly").objectStore(s.name).get(e);r.onerror=o,r.onsuccess=function(){n(r.result)}})})},getAll:async function(){return new Promise(e=>{this.connectDB(this,function(n,o){var t=[],s=n.transaction([o.name],"readonly").objectStore(o.name);s.mozGetAll?s.mozGetAll().onsuccess=function(n){e(n.target.result)}:s.openCursor().onsuccess=function(n){var o=n.target.result;o?(t.push(o.value),o.continue()):e(t)}})})},add:async function(e){return new Promise((n,o)=>{this.connectDB(this,function(t,s){var r=t.transaction([s.name],"readwrite").objectStore(s.name).add(e);r.onerror=o,r.onsuccess=function(){n({...e,id:r.result})}})})},delete:async function(e){return new Promise((n,o)=>{this.connectDB(this,async function(t,s){var r=t.transaction([s.name],"readwrite").objectStore(s.name),i=await r.get(e),c=r.delete(e);c.onerror=o,c.onsuccess=function(){n(i.result)}})})},put:async function(e){return new Promise((n,o)=>{this.connectDB(this,function(t,s){var r=t.transaction([s.name],"readwrite").objectStore(s.name);if(e.id){var i=r.put(e);i.onerror=o,i.onsuccess=function(){n({...e,id:i.result})}}else o("Object without id, can't update.")})})},clear:async function(){return new Promise(async(e,n)=>{let o=(await this.getAll()).map(e=>this.delete(e.id));Promise.all(o).then(e).catch(n)})},where:function(e){if(void 0===e)throw new Error('Missing "key" to search...');if("string"==typeof e)return{key:e,name:this.name,dbName:this.dbName,version:this.version,equal:async function(n){return new Promise((o,t)=>{var s=indexedDB.open(this.dbName,this.version);s.onerror=console.log,s.onsuccess=(()=>{let t=s.result;t.onversionchange=function(){t.close()};var r=[];t.transaction([this.name],"readonly").objectStore(this.name).openCursor().onsuccess=function(t){var s=t.target.result;s?(s.value[e]===n&&r.push(s.value),s.continue()):o(r)}})})},above:async function(n){return new Promise((o,t)=>{var s=indexedDB.open(this.dbName,this.version);s.onerror=console.log,s.onsuccess=(()=>{let t=s.result;t.onversionchange=function(){t.close()};var r=[];t.transaction([this.name],"readonly").objectStore(this.name).openCursor().onsuccess=function(t){var s=t.target.result;s?(s.value[e]>n&&r.push(s.value),s.continue()):o(r)}})})},below:async function(n){return new Promise((o,t)=>{var s=indexedDB.open(this.dbName,this.version);s.onerror=console.log,s.onsuccess=(()=>{let t=s.result;t.onversionchange=function(){t.close()};var r=[];t.transaction([this.name],"readonly").objectStore(this.name).openCursor().onsuccess=function(t){var s=t.target.result;s?(s.value[e]<n&&r.push(s.value),s.continue()):o(r)}})})},aboveEqual:async function(n){return new Promise((o,t)=>{var s=indexedDB.open(this.dbName,this.version);s.onerror=console.log,s.onsuccess=(()=>{let t=s.result;t.onversionchange=function(){t.close()};var r=[];t.transaction([this.name],"readonly").objectStore(this.name).openCursor().onsuccess=function(t){var s=t.target.result;s?(s.value[e]>=n&&r.push(s.value),s.continue()):o(r)}})})},belowEqual:async function(n){return new Promise((o,t)=>{var s=indexedDB.open(this.dbName,this.version);s.onerror=console.log,s.onsuccess=(()=>{let t=s.result;t.onversionchange=function(){t.close()};var r=[];t.transaction([this.name],"readonly").objectStore(this.name).openCursor().onsuccess=function(t){var s=t.target.result;s?(s.value[e]<=n&&r.push(s.value),s.continue()):o(r)}})})},notEqual:async function(n){return new Promise((o,t)=>{var s=indexedDB.open(this.dbName,this.version);s.onerror=console.log,s.onsuccess=(()=>{let t=s.result;t.onversionchange=function(){t.close()};var r=[];t.transaction([this.name],"readonly").objectStore(this.name).openCursor().onsuccess=function(t){var s=t.target.result;s?(s.value[e]!==n&&r.push(s.value),s.continue()):o(r)}})})}}},connectDB(e,n){var o=indexedDB.open(e.dbName,e.version);o.onerror=console.log,o.onsuccess=(()=>{let t=o.result;t.onversionchange=function(){t.close()},n(t,e)}),o.onupgradeneeded=function(n){var o=n.currentTarget.result;if(!o.objectStoreNames.contains(e.name)){let n={};e.fields.includes("++id")&&(n={keyPath:"id",autoIncrement:!0});var t=o.createObjectStore(e.name,n);e.fields.filter(e=>!e.includes("id")).forEach(e=>{let n=e.replace(/\&/g,"");t.createIndex(n,n,{unique:e.includes("&")})})}}}}});var s=indexedDB.open(this.dbName,this.version);s.onerror=o,s.onsuccess=(()=>{let e=s.result;e.onversionchange=function(){e.close()},n("Finished")}),s.onupgradeneeded=function(n){var o=n.currentTarget.result;t.forEach(n=>{if(!o.objectStoreNames.contains(n)){let t={},s=e[n].split(",");s.includes("++id")&&(t={keyPath:"id",autoIncrement:!0});let r=o.createObjectStore(n,t);s.filter(e=>!e.includes("id")).forEach(e=>{let n=e.replace(/\&/g,"");r.createIndex(n,n,{unique:e.includes("&")})})}})}})}});
